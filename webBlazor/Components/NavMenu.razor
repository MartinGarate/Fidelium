@inject FirebaseAuthService _firebaseAuthService

<nav class="fidelium-nav" id="mainNav" aria-label="Navegación principal">
    <div class="nav-wrapper">
        <!-- Logo izquierda -->
        <div class="nav-logo-section">
            <NavLink href="/" class="fidelium-logo" aria-label="Ir al inicio - Fidelium">
                <img src="images/Fidelium.png" alt="Fidelium Logo" class="logo-img" />
            </NavLink>
        </div>

        <!-- Menú central -->
        <ul class="fidelium-list" role="menubar">
            <li role="none">
                <NavLink role="menuitem" href="/" class="nav-link-item" Match="NavLinkMatch.All">
                    Inicio
                </NavLink>
            </li>
            <li role="none">
                <NavLink role="menuitem" href="/opinions" class="nav-link-item">
                    Mis Opiniones
                </NavLink>
            </li>
        </ul>

        <!-- Botones a la derecha -->
        <div class="nav-actions">
            @if (!isAuthenticated)
            {
                <NavLink class="btn-login" href="/login" aria-label="Iniciar sesión">
                    Iniciar Sesión
                </NavLink>
                <NavLink class="btn-register" href="/register" aria-label="Crear nueva cuenta">
                    Registrarse
                </NavLink>
            }
            else
            {
                <span class="user-greeting">Hola, @userDisplayName</span>
                <button class="btn-logout" @onclick="HandleLogout" aria-label="Cerrar sesión">
                    Cerrar Sesión
                </button>
            }
        </div>
    </div>
</nav>

@code {
    private bool isAuthenticated = false;
    private string userDisplayName = "Usuario";

    protected override async Task OnInitializedAsync()
    {
        isAuthenticated = await _firebaseAuthService.IsUserAuthenticated();
        if (isAuthenticated)
        {
            userDisplayName = await _firebaseAuthService.GetUserDisplayName() ?? "Usuario";
        }
        _firebaseAuthService.OnChangeLogin += LoginHasChanged;
    }

    private async void LoginHasChanged()
    {
        isAuthenticated = await _firebaseAuthService.IsUserAuthenticated();
        if (isAuthenticated)
        {
            userDisplayName = await _firebaseAuthService.GetUserDisplayName() ?? "Usuario";
        }
        StateHasChanged();
    }

    private async Task HandleLogout()
    {
        await _firebaseAuthService.SignOut();
        isAuthenticated = false;
        StateHasChanged();
    }

    public void Dispose()
    {
        _firebaseAuthService.OnChangeLogin -= LoginHasChanged;
    }
}


